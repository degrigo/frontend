<!DOCTYPE html>
<html lang="pt-BR">
	<head>
		<title>Tadeu Grigolon</title>
		<meta charset="utf-8" />
		<link rel="stylesheet" type="text/css" href="css/main.css">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<!-- DOM é a arvore de objetos do HTML, respeitando a hierarquia (documento == node, html == node)-->
	</head>
	<body>
		<div id="cabecalho">
			<!-- centralizando o conteúdo com centered -->
			<div class="centered">
				<div id="logo">
					<img src="images/logo.png" alt="Logo" />
				</div>
				<div id="menu">
					<img class="icon" id="menu_icon" src="images/icon_menu.png" alt="" />
					<ul id="menu_lista">
						<li><a href="#sobre">Sobre</a></li>
						<li><a href="#servicos">Serviços</a></li>
						<li><a href="#contato">Contato</a></li>
					</ul>					
				</div>
			</div>
		</div>
		<div id="sobre">
			<div class="centered">
				<h1>Tadeu Grigolon</h1>
				<p>
					Desenvolvedor Magento e músico nas horas vagas.
					<br />
					=
					<br />
					<strong>Ad angusta per angusta</strong>
				</p>
			</div>
		</div>
		<div id="servicos">
			<div class="centered">
				<h2>Serviços</h2>
				<div class="servico">
					<img src="images/servico_1.jpg" alt="Serviço 1" title="Serviço 1" />
					<div class="descricao">
						<h3>Nome do Projeto</h3>
						<p>É importante questionar o quanto...</p>
					</div>
				</div>
				<div class="servico">
					<img src="images/servico_2.jpg" alt="Serviço 2" title="Serviço 2" />
					<div class="descricao">
						<h3>Nome do Projeto</h3>
						<p>É importante questionar o quanto...</p>
					</div>
				</div>
				<div class="servico">
					<img src="images/servico_3.jpg" alt="Serviço 3" title="Serviço 3" />
					<div class="descricao">
						<h3>Nome do Projeto</h3>
						<p>É importante questionar o quanto...</p>
					</div>
				</div>
			</div>
		</div>
		<div id="contato">
			<div class="centered">
				<h2>Contato</h2>
				<!-- adicionando atrubuto onsubmit-->
				<!-- setando name contato -->
				<form action="#" name="contato" method="POST" onsubmit="return validar();">
					<table>
						<tr>
							<td>
								<!-- label trabalha com o id do input -->
								<label for="nome">Nome:</label>
								<input id="nome" type="text" name="nome" />
								<!-- adicionando texto de validação -->
								<span class="error"></span>
							</td>
						</tr>
						<tr>
							<td>
								<label for="email">E-mail:</label>
								<input id="email" type="email" name="email">
								<span class="error"></span>
							</td>
						</tr>
						<tr>
							<td>
								<!-- textarea com maxlenght, rows (linhas) e cols (colunas)  -->
								<label for="mensagem">Mensagem:</label>
								<textarea id="mensagem" name="mensagem"></textarea>
								<span class="error"></span>
							</td>
						</tr>
						<tr>
							<td>
								<input id="enviar" type="submit" name="enviar">
							</td>
						</tr>
					</table>
				</form>
			</div>
		</div>
		<script type="text/javascript">
			
			//referenciando o elemento com Id cabeçalho
			var cabecalho = document.getElementById("cabecalho");

			// pegar a posição inicial do cabeçalho com offsetTop

			var posYCabecalho = cabecalho.offsetTop;

			// setando variável que irá verificar se o click está vindo do menu hamburguer
			var menu_lista_ativo = false;
			// pegando posição do height
			//console.log($("#cabecalho").height);

			// setando classe na rolagem da página
			// setando o evento onscroll (usuário) como função, declarando stickybar
			window.onscroll = function(){
				stickyBar();
			};

			//seletor jQuery
			//acessando todos os links de menu_lista
			$("#menu_lista a").on("click", function(event){
				// pegando o valor da hash console.log(this.hash);

				if(this.hash != "") {
					//anular o comportamento padrão do navegador

					event.preventDefault();

					// efeito de animação com jQuery
					var hash = this.hash;
					var cabecalho_h = $("#cabecalho").height();
					var posicao = $(hash).offset().top - cabecalho_h;
					//setando animação
					$("html, body").animate({
						// tipo de animação scrollTop
						//posição da div, pegando offset no eixo Y
						// 500 é o tempo
						scrollTop: posicao
						//usando calback para update da url com a hash do elemento
					}, 500, function(){
						window.location.hash = hash;
					});

				}
			});

			// window.pageYOffset informa quantos pixels a janela foir rolada no eixo Y
			function stickyBar() {
				if(window.pageYOffset > posYCabecalho) {

					//incluir nova classe "sticky" nas classes do elemento cabecalho
					cabecalho.classList.add("sticky");

				} else {
					//remover classe "sticky" nas classes do elemento cabecalho
					cabecalho.classList.remove("sticky");
				}
			}

			//exibir menu de lista ao clicar no icon menu
			//pegando id da imagem
			var menuIcon = document.getElementById("menu_icon");
			// escutando o evento com addEventListener
			menu_icon.addEventListener('click', function() {

				var menu_lista = document.getElementById("menu_lista");
				//perguntar se o menu lista já está visível
				//esse cara já tem a classe showup setada
				if(menu_lista.classList.contains("showup")){
					//removendo a classe showup
					menu_lista.classList.remove("showup");
				} else {
					// arrumando conflitos de clicks
					menu_lista_ativo = true;
					// se a classe foi removida, adiciono ela novamente
					menu_lista.classList.add("showup");
				}
			});

			// observar elemento através do event listener no evento click
			window.addEventListener('click', function(event){
				//verificar se o ícone de menu está visível
				//verifica se a lista de menu está aberta

				//pegando os valores dos elementos menu_icon e menu_lista
				var menu_icon = document.getElementById("menu_icon");
				var menu_lista = document.getElementById("menu_lista");
				// pegando todos os estilos comṕutados pelo browser
				// segundo parâmetro pegaria valores de before e after
				//console.log(window.getComputedStyle(menu_icon, null)) imprime o resultado para verificar a lista de propriedades já computadas pelo browser
				// getValuePropertyValue pega os valores da propriedade setada
				menu_icon.currentDisplay = window.getComputedStyle(menu_icon, null).getPropertyValue("display");
				menu_lista.currentDisplay = window.getComputedStyle(menu_icon, null).getPropertyValue("display");

				//console.log(menu_lista.currentDisplay = window.getComputedStyle(menu_icon, null).getPropertyValue("display"));

				// mostra o alvo do click
				//console.log(event.target);


				// se o ícone de menu estiver visível
				// se o menu lista estiver visível
				// se o clik for fora da área do menu_lista
				// se o click for fora da area do menu_icon

				console.log(menu_lista_ativo);
				console.log(menu_icon.currentDisplay);
				console.log(menu_lista.currentDisplay);
				console.log(!menu_lista.contains(event.target));
				console.log(!menu_icon.contains(event.target));

				if(menu_lista_ativo === true && menu_icon.currentDisplay == "inline-block" && menu_lista.currentDisplay == "inline-block" && !menu_lista.contains(event.target) && !menu_icon.contains(event.target)) {
					//removendo classe do menu_lista
					console.log('ok');
					menu_lista.classList.remove("showup");
					menu_lista_ativo = false;
				}
			});

			function validar(){
				//localizar form no código
				var form = document.forms["contato"];
				// trazendo todos os elementos presentes dentro do form com o método elements
				var fields = form.elements; // objeto DOM elements
				// criando objeto orientacao, com valores associativos dentro dele
				var orientacao = {
					'nome' : "Informe um nome válido",
					'email' : "Informe um email válido",
					'mensagem' :  "Informe uma mensagem válida"
				};


				// adicionando regex que valida email
				var er_email = RegExp(/^[A-Za-z0-9_\-\.]+@[A-Za-z0-9_\-\.]{2,}\.[A-Za-z0-9]{2,}(\.[A-Za-z0-9])?/);

				// array vazio
				var required = [];

				// fields.lenght verifica quantas tags existe dentro do form
				for(var i = 0; i < fields.length; i++) {
					//adicionando email na validação
					if(fields[i].type != "submit" && fields[i].type != "email" 
						&& fields[i].value == "") {
						// campo vazio e deve ser preenchido
						// enviando a lista com valores para dentro do array
						required.push(fields[i]);

						// validação de email

					} else if (fields[i].type == "email" && 
						(fields[i].value == "" || er_email.test(fields[i].value) === false)) {
						// enviando valores para required
						required.push(fields[i]);

					} else if (fields[i].type != "submit" && fields[i].value != ""){
						// o campo foi preenchido.
						//devemos limpar a orientação, removendo a classe required caso exista
						// e adicionar a classe valid 

						// removendo classe required e adicionando valid
						fields[i].classList.remove("required");
						fields[i].classList.add("valid");
						// limpando orientação
						var span = fields[i].parentNode.getElementsByTagName("span")[0];
						span.innerHTML = "";
					}
				}

				//console.log(required);
				//return false;

				// algum item foi jogado dentro do array
				if(required.length > 0){
					//percorrendo lista de elementos com valor vazio
					for(var i = 0; i < required.length; i++){
						//adicionar nova classe css se o elemento for vazio
						required[i].classList.add("required");
						//acessando span
						//parentNode acessa o nó pai aon o elemento está inserido
						//getElementsByTagName seleciona o elemento DOM span, com o índice zero(primeiro da lista).
						var span = required[i].parentNode.getElementsByTagName("span")[0];
						// appendChild faz com que o JS entenda que elemento filho será adicionado dentro do span
						//createTextNode adiciona valor da string dentro do elemento span
						// pegando as mensagens de validação através do name do input
						// span.appendChild(document.createTextNode(orientacao[required[i].name]));
						
						// pouco importa o conteúdo, o que importa é o name dos inputs
						span.innerHTML = orientacao[required[i].name];
					}

					return false;

				} else {

					return true;
				}
			}
		</script>
	</body>
</html>
